Requirements:
   1. Control plane t2.medium 2cp, 2gb ram
   2. 2 workers nodes

SSH Permission:
chmod 600 ram.pem
ssh-keygen
chmod 600 
###
step1: install docker in all servers

#!/bin/bash
sudo apt update -y
sudo apt install -y apt-transport-https ca-certificates curl software-properties-common
sudo apt install -y docker.io
sudo systemctl enable docker
sudo systemctl start docker
sudo usermod -aG docker ubuntu
newgrp docker
docker --version

###
step2: Download RKE binary in masterplane or local
###
RKE installtion:

#!/bin/bash
wget https://github.com/rancher/rke/releases/download/v1.8.7/rke_linux-amd64 -O rke
chmod +x rke
sudo mv rke /usr/local/bin/rke
rke --version

###
step3: Rancher Images:

kubernetes: rke-extended-life/hyperkube:v1.32.8-rancher1
kubernetes: rancher/hyperkube:v1.27.14-rancher1

###
step 4: install kubectl

curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl.sha256"
echo "$(cat kubectl.sha256)  kubectl" | sha256sum --check
sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
chmod +x kubectl
mkdir -p ~/.local/bin
mv ./kubectl ~/.local/bin/kubectl
# and then append (or prepend) ~/.local/bin to $PATH
sudo kubectl version --client

###
step:5 To copy config file
scp -i "deep.pem" ./kube_config_cluster.yml ubuntu@54.157.215.567:~/kube_config_cluster.yml

###
step:6
export KUBECONFIG=./kube_config_cluster.yml
kubectl get nodes
kubectl get pods -A

########################################

Rancher GUI Installation:


step:7 Install Helm (v3)
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
helm version

###
Step 8: Install cert-manager (for HTTPS)
kubectl create namespace cert-manager
helm repo add jetstack https://charts.jetstack.io
helm repo update
helm install cert-manager jetstack/cert-manager \
  --namespace cert-manager \
  --version v1.12.3 \
  --set installCRDs=true
kubectl get pods -n cert-manager

Check pods:
kubectl get pods -n cert-manager

###
step 9: Add Rancher Helm Repo
helm repo add rancher-stable https://releases.rancher.com/server-charts/stable
helm repo update

###
step10: Create Namespace for Rancher
kubectl create namespace cattle-system

###
step 11: Install Rancher
helm install rancher rancher-stable/rancher \
  --namespace cattle-system \
  --set hostname=rancher.3.84.97.131.nip.io\
  ----set replicas=1

Check Pod Logs (Optional):
kubectl logs -f rancher-679d7f5d94-kz2df -n cattle-system-1
https://rancher.3.84.971.331.nip.io

###
step 12: Wait for Rancher to Start
kubectl -n cattle-system get pods

###
Step 13: Access Rancher GUI
kubectl -n cattle-system get svc rancher

Rancher generates a bootstrap admin password in a secret. Get it with:
kubectl get secret -n cattle-system-1 bootstrap-secret -o go-template='{{.data.bootstrapPassword | base64decode}}{{"\n"}}'

Verify Cluster and Services:
kubectl get pods -A
kubectl get svc -n cattle-system-1

###
Rancher Uninstall: 
helm uninstall rancher -n cattle-system
kubectl delete namespace cattle-system

###
step 14: Change to NodePort (Quick & Easy
kubectl -n cattle-system-1 patch svc rancher -p '{"spec": {"type": "NodePort"}}'
kubectl -n cattle-system-1 get svc rancher
